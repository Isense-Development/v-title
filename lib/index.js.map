{"version":3,"file":"index.js","sources":["../src/utils/tooltip.js","../src/directives/title.js","../src/index.js"],"sourcesContent":["import Tooltip from 'tooltip.js';\n\n// 依赖 element-ui 的 tooltip 样式，在 element-ui.js 中单独引入\n// import 'element-ui/packages/theme-chalk/lib/tooltip.css';\n\nconst zIndex = 4000; // 默认的 z-index 值\nconst refs = {};\nlet tooltipId = 0;\n\n/**\n * create tooltip\n * @param {HTMLElement} el\n * @param {String} title\n * @param {String<'light'|'dark'>} effect\n * @param {String} placement\n * @return {Tooltip}\n */\nexport function tooltipCreate(el, title, { effect, placement }) {\n  const id = (el.dataset.tooltipId =\n    el.dataset.tooltipId || String(++tooltipId));\n  let tooltip;\n\n  if (!refs.hasOwnProperty(id)) {\n    tooltip = new Tooltip(el, {\n      placement,\n      // @require 'element-ui/packages/theme-chalk/lib/tooltip.css'\n      template: `\n        <div \n          class=\"tooltip el-tooltip__popper is-${effect}\" \n          role=\"tooltip\" \n          style=\"transition: opacity 200ms linear;opacity: 0;z-index: ${zIndex}\">\n          <div class=\"tooltip__arrow popper__arrow\"></div>\n          <div class=\"tooltip__inner\"></div>\n        </div>\n      `,\n      title,\n      trigger: 'manual',\n      popperOptions: {\n        modifiers: {\n          preventOverflow: { enabled: false },\n          hide: { enabled: false }\n        },\n        removeOnDestroy: true\n      },\n      container: document.body\n    });\n    tooltip.show();\n    refs[id] = tooltip;\n  } else {\n    tooltip = refs[id];\n    clearTimeout(tooltip._timeout);\n  }\n\n  // transition\n  tooltip.popperInstance && (tooltip.popperInstance.popper.style.opacity = 1);\n\n  return tooltip;\n}\n\n/**\n * remove tooltip\n * @param {HTMLElement} el\n * @param {Number} delayHide\n */\nexport function tooltipRemove(el, delayHide = 200) {\n  const id = el.dataset.tooltipId;\n  const tooltip = refs[id];\n  if (tooltip) {\n    if (tooltip._timeout) clearTimeout(tooltip._timeout);\n    tooltip.popperInstance && (tooltip.popperInstance.popper.style.opacity = 0);\n    tooltip._timeout = setTimeout(() => {\n      tooltip.dispose();\n      delete refs[id];\n    }, delayHide);\n  }\n}\n\n/**\n * update tooltip title\n * @param {HTMLElement} el\n * @param {String} title\n */\nexport function tooltipUpdateTitle(el, title) {\n  const id = el.dataset.tooltipId;\n  const tooltip = refs[id];\n  if (tooltip) {\n    tooltip.updateTitleContent(title);\n  }\n}\n","/**\n * 辅助文字展示（类似el-tooltip）\n *\n * @modifier light 主题 dark/light，默认 dark\n * @modifier overflow 是否溢出模式，文字显示省略号时才显示，默认 false\n * @attr {String} tooltip-placement 位置 top(-start, -end), right(-start, -end), bottom(-start, -end), left(-start, -end)，默认 top\n * @example\n * ```\n * <div v-title.overflow.dark=\"'test'\" tooltip-placement=\"top\"></div>\n * ```\n */\n\nimport debounce from 'lodash/debounce';\n\nimport {\n  tooltipRemove,\n  tooltipCreate,\n  tooltipUpdateTitle\n} from '@/utils/tooltip';\n\n// 存放所有的 tooltip 数据\nconst tooltipData = {\n  // 1: {}\n};\nconst tooltipIdName = 'tooltip-id';\nconst delayHide = 200; // @require('../utils/tooltip.js#tooltipCreate') transition: 200ms\nlet tooltipId = 0; // 递增\n\nexport default {\n  inserted(el, binding) {\n    // 设置 tooltip-id\n    const id = ++tooltipId;\n    el.setAttribute(tooltipIdName, id + '');\n    const data = (tooltipData[id] = {\n      id,\n      activateTooltip: null,\n      deactivateTooltip: null\n    });\n\n    // 主题, 位置, 是否溢出模式\n    const effect = binding.modifiers.light ? 'light' : 'dark';\n    const placement = el.getAttribute('title-placement') || 'top';\n    const overflow = !!binding.modifiers.overflow;\n\n    // 创建 add/remove 事件\n    data.deactivateTooltip = debounce((event) => {\n      deactivateTooltip(event.target);\n    }, delayHide);\n    data.activateTooltip = (event) => {\n      data.deactivateTooltip.cancel();\n      if (data.tooltipRemoveTimeout) clearTimeout(data.tooltipRemoveTimeout);\n      activateTooltip(event.target, binding.value, {\n        effect,\n        placement,\n        overflow\n      });\n    };\n\n    // 绑定事件\n    el.addEventListener('mouseenter', data.activateTooltip, false);\n    el.addEventListener('mouseleave', data.deactivateTooltip, false);\n    el.addEventListener('click', data.deactivateTooltip, false);\n  },\n  componentUpdated(el, binding) {\n    tooltipUpdateTitle(el, binding.value);\n  },\n  unbind(el) {\n    // 销毁事件与数据\n    const data = getTooltipData(el);\n    if (data) {\n      el.removeEventListener('mouseenter', data.activateTooltip, false);\n      el.removeEventListener('mouseleave', data.deactivateTooltip, false);\n      el.removeEventListener('click', data.deactivateTooltip, false);\n\n      // 直接移除当前的 tooltip（例如：当点击进行路由切换时需要）\n      tooltipRemove(el, 0);\n    }\n  }\n};\n\nfunction activateTooltip(el, title, { effect, placement, overflow }) {\n  if (!overflow || (overflow && checkOverflow(el))) {\n    tooltipCreate(el, title, { effect, placement });\n  }\n}\n\nfunction deactivateTooltip(el) {\n  tooltipRemove(el, delayHide);\n}\n\nfunction checkOverflow(elem) {\n  return elem.scrollWidth > elem.offsetWidth;\n}\n\nfunction getTooltipData(el) {\n  const id = el.getAttribute(tooltipIdName);\n  if (tooltipData.hasOwnProperty(id)) {\n    return tooltipData[id];\n  } else {\n    return null;\n  }\n}\n","// 主组件\nimport VTitle from '@/directives/title';\n\n// tooltip utils\nexport {\n  tooltipCreate,\n  tooltipRemove,\n  tooltipUpdateTitle\n} from './utils/tooltip';\n\n// Vue.use()\nVTitle.install = (Vue) => {\n  Vue.directive('title', VTitle);\n};\n\n// Vue.component()\nexport default VTitle;\n"],"names":["zIndex","refs","tooltipId","tooltipCreate","el","title","effect","placement","id","dataset","String","tooltip","hasOwnProperty","Tooltip","template","trigger","popperOptions","modifiers","preventOverflow","enabled","hide","removeOnDestroy","container","document","body","show","clearTimeout","_timeout","popperInstance","popper","style","opacity","tooltipRemove","delayHide","setTimeout","dispose","tooltipUpdateTitle","updateTitleContent","tooltipData","tooltipIdName","inserted","binding","setAttribute","data","activateTooltip","deactivateTooltip","light","getAttribute","overflow","debounce","event","target","cancel","tooltipRemoveTimeout","value","addEventListener","componentUpdated","unbind","getTooltipData","removeEventListener","checkOverflow","elem","scrollWidth","offsetWidth","VTitle","install","Vue","directive"],"mappings":"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"}